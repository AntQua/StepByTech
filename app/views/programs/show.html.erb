<div class="bg-white rounded-4 p-3 mb-4">
  <h2><%= @program.title %></h2>
  <p><%= @program.description %></p>
  <div class="row mb-3">
    <div class="col">
      <p>Data de início da inscrição : <%= @program.registration_start_date %></p>
    </div>
    <div class="col">
      <p>Data de fim da inscrição : <%= @program.registration_end_date %></p>
    </div>
  </div>
  <div class="row mb-3">
    <div class="col">
      <p>Data de início : <%= @program.begin_date %></p>
    </div>
    <div class="col">
      <p>Data de fim: <%= @program.end_date %></p>
    </div>
  </div>
  <p>Número máximo de candidatos: <%= @program.registration_limit %></p>
  <p>Activo: <%= @program.active ? "Sim" : "Não" %></p>
  <p>Completo: <%= !@program.completed ? "Programa a decorrer" : "Programa finalizado" %></p>

  <div class="d-flex justify-content-between align-items-center">
    <%= link_to "Regressar a Lista de Programas", programs_path, class: "btn btn-primary mt-3" %>
    <%= link_to "Editar Programa", edit_program_path(@program), class: "btn btn-secondary mt-3" %>
    <%= link_to "Criar Step", new_program_step_path(@program), class: "btn btn-primary mt-3" %>
    <%= link_to "Cancelar", program_path(@program), data: {turbo_method: :delete, turbo_confirm: "Tem a certeza que pretende cancelar o programa de #{@program.title}?" }, class: "btn btn-danger mt-3" %>
  </div>
</div>


<div class="steps-list row">
  <% @program.steps.each do |step| %>
    <div class="steps-card col-md-4 mb-4">
      <div class="card h-100 bg-white rounded-4 d-flex flex-column">
        <div class="card-body flex-grow-1">
          <div class="card-title d-flex justify-content-between align-items-center">
            <h3>Step <%= step.step_order %> - <%= step.name %></h3>
          </div>
          <p class="card-text"><%= step.description %></p>
          <p>Dias das sessões:</p>
          <% if step.dates.present? %>
            <% grouped_dates = step.dates.group_by { |date| date.strftime('%B') } %>
            <% sessions_strings = grouped_dates.map do |month, dates|
              days = dates.map { |date| date.day }.compact.uniq.sort
              next if days.empty?
              formatted_days = if days.length == 1
                days.first.to_s
              else
                days[0...-1].join(', ') + " e #{days.last}"
              end
              "- #{month} dias #{formatted_days}"
            end.reject(&:nil?).join('<br>').html_safe %>
            <%= sessions_strings %>
          <% end %>

          <p class="mt-2">Início: <%= step.hour_start.strftime('%H:%M') if step.hour_start %> | Fim: <%= step.hour_finish.strftime('%H:%M') if step.hour_finish %></p>
        </div>

        <!-- Adding the icon link to the bottom right of the card using Bootstrap -->
        <div class="card-footer border-0 bg-transparent text-end">
          <%= link_to program_step_path(step.program, step) do %>
            <i class="fa-solid fa-circle-info text-success"></i>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>
</div>
